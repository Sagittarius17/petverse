{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the PetVerse application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "The first name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "The last name of the user."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "bio": {
          "type": "string",
          "description": "A short biography of the user."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the user account was created."
        },
        "role": {
          "type": "string",
          "description": "The role of the user, determining their access level.",
          "enum": ["User", "Superuser", "Admin", "Superadmin"]
        },
        "status": {
            "type": "string",
            "description": "The status of the user account.",
            "enum": ["Active", "Inactive"]
        },
        "isOnline": {
            "type": "boolean",
            "description": "Indicates if the user is currently online."
        },
        "lastSeen": {
            "type": "string",
            "format": "date-time",
            "description": "The timestamp when the user was last seen online."
        },
        "address": {
          "type": "object",
          "description": "The user's saved shipping address.",
          "properties": {
            "fullName": { "type": "string" },
            "streetAddress": { "type": "string" },
            "city": { "type": "string" },
            "zip": { "type": "string" }
          }
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "Pet": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Pet",
      "type": "object",
      "description": "Represents a pet available for adoption or listed as lost/found.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the pet entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the pet."
        },
        "species": {
          "type": "string",
          "description": "The species of the pet (e.g., dog, cat, bird)."
        },
        "breed": {
          "type": "string",
          "description": "The breed of the pet."
        },
        "age": {
          "type": "number",
          "description": "The age of the pet in months/years."
        },
        "gender": {
          "type": "string",
          "description": "The gender of the pet."
        },
        "description": {
          "type": "string",
          "description": "A detailed description of the pet."
        },
        "photoUrls": {
          "type": "array",
          "description": "An array of URLs to photos of the pet.",
          "items": {
            "type": "string"
          }
        },
        "isAdoptable": {
          "type": "boolean",
          "description": "Indicates whether the pet is available for adoption.",
          "default": true
        },
        "isLost": {
          "type": "boolean",
          "description": "Indicates whether the pet is lost."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns/found the pet. (Relationship: User 1:N Pet)"
        },
        "viewCount": {
            "type": "number",
            "description": "The number of times the pet's profile has been viewed."
        }
      },
      "required": [
        "id",
        "name",
        "species"
      ]
    },
    "FavoriteBreed": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FavoriteBreed",
      "type": "object",
      "description": "Represents a user's favorite pet breed.",
      "properties": {
        "breedId": {
          "type": "string",
          "description": "Reference to the Pet Breed that is favorited."
        }
      },
      "required": ["breedId"]
    },
    "Blog": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Blog",
      "type": "object",
      "description": "Represents a blog post or article.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the blog entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the blog post."
        },
        "content": {
          "type": "string",
          "description": "The content of the blog post."
        },
        "authorId": {
          "type": "string",
          "description": "Reference to the User who authored the blog post. (Relationship: User 1:N Blog)"
        },
        "authorName": {
          "type": "string",
          "description": "Denormalized name of the author for display purposes."
        },
        "createdAt": {
          "type": "string",
          "description": "The date and time the blog post was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "The date and time the blog post was last updated.",
          "format": "date-time"
        },
        "categoryName": {
            "type": "string",
            "description": "Denormalized name of the category for display purposes."
        },
        "status": {
            "type": "string",
            "enum": ["Draft", "Published"],
            "description": "The publication status of the blog post."
        }
      },
      "required": [
        "id",
        "title",
        "content",
        "authorId",
        "authorName"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category for blog posts or pet care guides.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the category."
        },
        "description": {
          "type": "string",
          "description": "A description of the category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "VetService": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "VetService",
      "type": "object",
      "description": "Represents a veterinary service or clinic.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the vet service entity."
        },
        "name": {
          "type": "string",
          "description": "The name of the veterinary service."
        },
        "address": {
          "type": "string",
          "description": "The address of the veterinary service."
        },
        "phoneNumber": {
          "type": "string",
          "description": "The phone number of the veterinary service."
        },
        "website": {
          "type": "string",
          "description": "The website URL of the veterinary service.",
          "format": "uri"
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who owns/manages the vet service. (Relationship: User 1:N VetService)"
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "LostFoundReport": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LostFoundReport",
      "type": "object",
      "description": "Represents a report of a lost or found pet.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the lost/found report entity."
        },
        "petId": {
          "type": "string",
          "description": "Reference to the Pet that is lost or found. (Relationship: Pet 1:N LostFoundReport)"
        },
        "reportType": {
          "type": "string",
          "description": "The type of report (lost or found)."
        },
        "reportDate": {
          "type": "string",
          "description": "The date the report was created.",
          "format": "date-time"
        },
        "location": {
          "type": "string",
          "description": "The location where the pet was lost or found."
        },
        "contactInfo": {
          "type": "string",
          "description": "Contact information for the person reporting the lost/found pet."
        },
        "userId": {
          "type": "string",
          "description": "Reference to the User who filed the report. (Relationship: User 1:N LostFoundReport)"
        }
      },
      "required": [
        "id",
        "petId",
        "reportType"
      ]
    },
    "Activity": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Activity",
      "description": "Represents a logged administrative action.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who performed the action."
        },
        "userName": {
          "type": "string",
          "description": "The name of the user who performed the action."
        },
        "userAvatar": {
          "type": "string",
          "format": "uri",
          "description": "URL of the user's avatar."
        },
        "action": {
          "type": "string",
          "description": "A short description of the action taken (e.g., 'Changed Role', 'Disabled User')."
        },
        "target": {
          "type": "string",
          "description": "The identifier of the object that was acted upon (e.g., user email, blog title)."
        },
        "targetType": {
          "type": "string",
          "enum": [
            "User",
            "Blog",
            "Pet"
          ]
        },
        "details": {
          "type": "string",
          "description": "More detailed information about the action."
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "The timestamp when the activity occurred."
        },
        "badgeVariant": {
          "type": "string",
          "enum": [
            "default",
            "secondary",
            "destructive"
          ]
        },
        "iconName": {
          "type": "string",
          "description": "The name of the lucide-react icon to display."
        }
      },
      "required": [
        "userId",
        "userName",
        "action",
        "target",
        "targetType",
        "timestamp"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "description": "Represents a product in the e-commerce shop.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "price": {
          "type": "number"
        },
        "category": {
          "type": "string",
          "enum": ["Food", "Toys", "Accessories", "Bedding"]
        },
        "imageId": {
          "type": "string"
        },
        "isFeatured": {
          "type": "boolean"
        }
      },
      "required": [
        "id",
        "name",
        "price",
        "category",
        "imageId"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "description": "Represents a customer order from the e-commerce shop.",
      "type": "object",
      "properties": {
        "id": { "type": "string" },
        "userId": { "type": "string", "description": "Reference to the User who placed the order." },
        "items": {
          "type": "array",
          "description": "An array of products in the order.",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" },
              "quantity": { "type": "number" },
              "price": { "type": "number" }
            },
            "required": ["id", "name", "quantity", "price"]
          }
        },
        "subtotal": { "type": "number" },
        "paymentMethod": { "type": "string" },
        "razorpayPaymentId": { "type": "string", "description": "The payment ID from Razorpay." },
        "status": { "type": "string", "enum": ["Placed", "Shipped", "Delivered", "Cancelled"] },
        "orderDate": { "type": "string", "format": "date-time" }
      },
      "required": ["userId", "items", "subtotal", "paymentMethod", "status", "orderDate"]
    },
    "Conversation": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Conversation",
      "description": "Represents a chat conversation between two or more users.",
      "type": "object",
      "properties": {
        "participants": {
          "type": "array",
          "items": { "type": "string" },
          "description": "An array of user IDs participating in the conversation."
        },
        "lastMessage": {
          "type": "object",
          "properties": {
            "text": { "type": "string" },
            "timestamp": { "type": "string", "format": "date-time" }
          },
          "description": "A summary of the last message for display in conversation lists."
        },
        "typing": {
            "type": "object",
            "properties": {},
            "additionalProperties": { "type": "boolean" },
            "description": "A map of user IDs to a boolean indicating if they are typing."
        },
        "unreadCount": {
          "type": "object",
          "properties": {},
          "additionalProperties": { "type": "number" },
          "description": "A map of user IDs to their unread message count for this conversation."
        }
      },
      "required": ["participants"]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "description": "Represents a single message within a conversation.",
      "type": "object",
      "properties": {
        "senderId": { "type": "string" },
        "text": { "type": "string" },
        "timestamp": { "type": "string", "format": "date-time" },
        "isRead": { "type": "boolean", "default": false }
      },
      "required": ["senderId", "text", "timestamp"]
    },
    "Notification": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Notification",
      "description": "Represents a global notification for an event like an adoption.",
      "type": "object",
      "properties": {
        "id": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time"
        },
        "type": {
          "type": "string",
          "enum": ["adoption"]
        }
      },
      "required": ["id", "title", "description", "timestamp", "type"]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Accessible only to the authenticated user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/pets/{petId}",
        "definition": {
          "entityName": "Pet",
          "schema": {
            "$ref": "#/backend/entities/Pet"
          },
          "description": "Pets owned/managed by a user. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "petId",
              "description": "The unique identifier of the pet."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favoriteBreeds/{breedId}",
        "definition": {
          "entityName": "FavoriteBreed",
          "schema": {
            "$ref": "#/backend/entities/FavoriteBreed"
          },
          "description": "Stores user's favorite pet breeds. The document ID is the same as the breedId.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "breedId",
              "description": "The unique identifier of the favorited breed."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores customer orders from the shop. Read access is restricted to the owner and admins.",
          "params": [
            { "name": "userId", "description": "The unique identifier of the user." },
            { "name": "orderId", "description": "The unique identifier for the order." }
          ]
        }
      },
      {
        "path": "/pets/{petId}",
        "definition": {
            "entityName": "Pet",
            "schema": {
                "$ref": "#/backend/entities/Pet"
            },
            "description": "A collection of all pets available for adoption.",
            "params": [
                {
                    "name": "petId",
                    "description": "The unique identifier for the pet."
                }
            ]
        }
      },
      {
        "path": "/blogs/{blogId}",
        "definition": {
          "entityName": "Blog",
          "schema": {
            "$ref": "#/backend/entities/Blog"
          },
          "description": "Stores blog posts. Public read access, restricted creation/editing.",
          "params": [
            {
              "name": "blogId",
              "description": "The unique identifier of the blog post."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores categories for blogs and pet care guides. Public access.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier of the category."
            }
          ]
        }
      },
      {
        "path": "/vet_services/{vetServiceId}",
        "definition": {
          "entityName": "VetService",
          "schema": {
            "$ref": "#/backend/entities/VetService"
          },
          "description": "Stores veterinary services. Includes denormalized 'userId' field for authorization independence.",
          "params": [
            {
              "name": "vetServiceId",
              "description": "The unique identifier of the vet service."
            }
          ]
        }
      },
      {
        "path": "/lost_found_reports/{lostFoundReportId}",
        "definition": {
          "entityName": "LostFoundReport",
          "schema": {
            "$ref": "#/backend/entities/LostFoundReport"
          },
          "description": "Stores lost/found reports. Includes denormalized 'userId' and 'petId' for authorization independence and efficient queries.",
          "params": [
            {
              "name": "lostFoundReportId",
              "description": "The unique identifier of the lost/found report."
            }
          ]
        }
      },
      {
        "path": "/activities/{activityId}",
        "definition": {
          "entityName": "Activity",
          "schema": {
            "$ref": "#/backend/entities/Activity"
          },
          "description": "Stores a log of administrative activities. Read access is restricted to admins and superusers.",
          "params": [
            {
              "name": "activityId",
              "description": "The unique identifier for the activity log entry."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "A collection of all products available in the shop.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}",
        "definition": {
          "entityName": "Conversation",
          "schema": { "$ref": "#/backend/entities/Conversation" },
          "description": "Top-level collection for conversations. The document ID is a composite key of participant UIDs.",
          "params": [
            { "name": "conversationId", "description": "The unique identifier of the conversation." }
          ]
        }
      },
      {
        "path": "/conversations/{conversationId}/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": { "$ref": "#/backend/entities/Message" },
          "description": "Subcollection for messages within a conversation. Accessible only to participants.",
          "params": [
            { "name": "conversationId", "description": "The unique identifier of the conversation." },
            { "name": "messageId", "description": "The unique identifier of the message." }
          ]
        }
      },
      {
        "path": "/notifications/{notificationId}",
        "definition": {
          "entityName": "Notification",
          "schema": {
            "$ref": "#/backend/entities/Notification"
          },
          "description": "Stores global notifications for events like adoptions.",
          "params": [
            {
              "name": "notificationId",
              "description": "The unique identifier of the notification."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and debuggability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization, copying relevant authorization data (like user IDs or membership maps) into subcollections to avoid costly and insecure `get()` calls in security rules. Structural Segregation separates data with different access requirements into distinct collections. Access Modeling employs consistent patterns like path-based ownership (`/users/{userId}/...`) and membership maps for collaborative data.\n\nSpecifically:\n\n*   `/users/{userId}`: Stores user profiles. User data is private and accessible only to the authenticated user. New fields `isOnline` and `lastSeen` have been added to support the chat presence feature.\n*   `/users/{userId}/pets/{petId}`: Pets owned/managed by a user. The `userId` field in the Pet document duplicates the parent path, ensuring authorization independence.\n*   `/users/{userId}/favoriteBreeds/{breedId}`: A new subcollection to store a user's favorite pet breeds. The document ID (`breedId`) will be the same as the breed's unique ID for easy lookup and to prevent duplicates.\n*   `/users/{userId}/orders/{orderId}`: Stores customer orders from the shop. Read access is restricted to the owner and admins.\n*   `/pets/{petId}`: A new top-level collection for publicly listed adoptable pets. This makes querying for all adoptable pets efficient and secure without needing to scan subcollections. Each pet document will store all necessary details, including a `viewCount`.\n*   `/blogs/{blogId}`: Stores blog posts. While a `authorId` field exists, access to blogs will be public, though editing/creation is restricted to admins.\n*   `/categories/{categoryId}`: Stores categories for blogs and pet care guides. Access is public.\n*   `/vet_services/{vetServiceId}`: Stores veterinary services. A `userId` field is present indicating the owner, enabling path-based access control for owners and public read access.\n*   `/lost_found_reports/{lostFoundReportId}`: Stores lost/found reports. The `userId` is duplicated within the document, providing authorization independence. The `petId` allows retrieval of reports by pet.\n\nThis structure facilitates simple, robust, and easily debuggable security rules by making authorization context explicit and eliminating hierarchical dependencies. QAPs are supported through structural segregation and well-defined ownership, allowing secure listing operations."
  }
}
